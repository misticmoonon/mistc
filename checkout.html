<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <title>Checkout</title>
  <style>
        body { padding: 20px; }
    .checkout-container { max-width: 600px; margin: auto; }
    .checkout-container h2 { margin-bottom: 20px; }
    .checkout-container ul { list-style: none; padding: 0; margin-bottom: 20px; }
    .checkout-container li { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid #ccc; }
    .checkout-container input, .checkout-container select, .checkout-container button { margin-bottom: 10px; }
    .button-finalizar { background-color: rgb(66, 0, 128); color: rgb(212, 195, 195); width: 100%; }
    #qrCode { display: block; margin: 10px auto; max-width: 200px; }
  </style>
</head>
<body>

<div class="checkout-container">
  <h2>Resumo da Compra</h2>
  <ul id="resumoCarrinho"></ul>
  <p>Total: R$ <span id="totalCompra">0.00</span></p>

  <h3>Informações do Cliente</h3>
  <input type="text" id="nomeCliente" placeholder="Nome completo" class="form-control">
  <input type="email" id="emailCliente" placeholder="E-mail" class="form-control">
  <input type="text" id="enderecoCliente" placeholder="Endereço de entrega" class="form-control">

  <h3>Método de Entrega</h3>
  <select id="metodoEntrega" class="form-control">
    <option value="">Selecione a entrega</option>
    <option value="padrao">Padrão</option>
    <option value="expresso">Expresso</option>
  </select>

  <h3>Pagamento</h3>
  <select id="metodoPagamento" class="form-control" onchange="atualizarCamposPagamento()">
    <option value="">Selecione o método de pagamento</option>
    <option value="cartao_credito">Cartão de Crédito</option>
    <option value="cartao_debito">Cartão de Débito</option>
    <option value="pix">Pix</option>
    <option value="boleto">Boleto Bancário</option>
  </select>

  <div id="camposCartao" style="display:none;">
    <input type="text" id="cartaoCliente" placeholder="Número do cartão" class="form-control">
    <input type="text" id="validadeCartao" placeholder="Validade" class="form-control">
    <input type="text" id="cvvCartao" placeholder="CVV" class="form-control">
  </div>

  <div id="camposPix" style="display:none;">
    <p>Use o QR code abaixo para efetuar o pagamento via Pix:</p>
    <img id="qrCode" src="" alt="QR Code Pix">
    <button type="button" onclick="gerarQR()">Gerar QR Code</button>
  </div>

  <div id="camposBoleto" style="display:none;">
    <p>O boleto será gerado após a confirmação do pedido.</p>
  </div>

  <button onclick="concluirCompra()" class="button-finalizar">Concluir Compra</button>
</div>

<script>
  let carrinho = JSON.parse(localStorage.getItem('carrinho')) || [];
  let total = parseFloat(localStorage.getItem('total')) || 0.00;

  const resumoCarrinho = document.getElementById('resumoCarrinho');
  const totalCompra = document.getElementById('totalCompra');
  totalCompra.textContent = total.toFixed(2);

  carrinho.forEach(item => {
      const li = document.createElement('li');
      li.textContent = `${item.nome} - R$ ${item.preco.toFixed(2)} x ${item.quantidade}`;
      resumoCarrinho.appendChild(li);
  });

  function atualizarCamposPagamento() {
    const metodo = document.getElementById('metodoPagamento').value;
    const camposCartao = document.getElementById('camposCartao');
    document.getElementById('camposPix').style.display = metodo === 'pix' ? 'block' : 'none';
    document.getElementById('camposBoleto').style.display = metodo === 'boleto' ? 'block' : 'none';
    camposCartao.style.display = (metodo === 'cartao_credito' || metodo === 'cartao_debito') ? 'block' : 'none';
    if(metodo === 'pix') gerarQR(); // gera QR ao selecionar Pix
  }

  function gerarQR() {
    const valorPix = total.toFixed(2);
    const chavePix = "meuemail@exemplo.com";
    const textoQR = `PIX:${chavePix};VALOR:${valorPix};`;
    const qrImg = document.getElementById('qrCode');
    qrImg.src = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(textoQR)}`;
  }

  function concluirCompra() {
      const nome = document.getElementById('nomeCliente').value;
      const email = document.getElementById('emailCliente').value;
      const endereco = document.getElementById('enderecoCliente').value;
      const entrega = document.getElementById('metodoEntrega').value;
      const pagamento = document.getElementById('metodoPagamento').value;

      if (!nome || !email || !endereco || !entrega || !pagamento) {
          alert('Por favor, preencha todos os dados e selecione método de entrega e pagamento!');
          return;
      }

      if (pagamento === 'cartao_credito' || pagamento === 'cartao_debito') {
          const numero = document.getElementById('cartaoCliente').value;
          const validade = document.getElementById('validadeCartao').value;
          const cvv = document.getElementById('cvvCartao').value;
          if (!numero || !validade || !cvv) {
              alert('Por favor, preencha os dados do cartão!');
              return;
          }
      }

      alert('Compra concluída com sucesso!\nObrigado pela preferência.');

      localStorage.removeItem('carrinho');
      localStorage.removeItem('total');
      window.location.href = "index.html";
  }
</script>

</body>
</html>
